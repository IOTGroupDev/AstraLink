================================================================================
                    ASTRALINK BACKEND - QUICK REFERENCE
                  Supabase Client vs Prisma Data Access
================================================================================

LEGEND:
  âœ… = Uses this technology
  âŒ = Does NOT use this technology
  âš ï¸  = Mixed/Inconsistent usage
  * = Should be migrated

================================================================================
KEY FINDINGS AT A GLANCE
================================================================================

Total Tables Accessed:        14
â”œâ”€ In Prisma:                5  (charts, connections, dating_matches, 
â”‚                                subscriptions, users)
â””â”€ Supabase Only:            10 (user_profiles, user_photos, user_blocks, 
                                 user_reports, messages, matches, payments,
                                 feature_usage, user_fomo_counters, _test)

================================================================================
SERVICES & THEIR DATA ACCESS PATTERNS
================================================================================

â”Œâ”€ USER SERVICE (user.service.ts) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Prisma:  public_users, chart, connection, datingMatch, subscription  â”‚
â”‚  âœ… Supabase: users (upsert), user_blocks, user_reports, charts (delete) â”‚
â”‚  ğŸ’¡ Uses Prisma $transaction() for account deletion (GOOD!)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ CHART SERVICE (chart.service.ts) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Prisma:  subscription (caching)                                      â”‚
â”‚  âš ï¸ Supabase: charts (AI timestamp, rate limiting)           *SHOULD FIXâ”‚
â”‚  ğŸ’¡ Mixed pattern - should consolidate to Prisma                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ DATING SERVICE (dating.service.ts) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Prisma:  chart, datingMatch                                          â”‚
â”‚  âš ï¸ Supabase: users, user_profiles *, user_photos, charts       *NEEDS  â”‚
â”‚  ğŸ’¡ user_profiles NOT in Prisma - CRITICAL GAP                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ SUBSCRIPTION SERVICE (subscription.service.ts) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Supabase: subscriptions, payments, charts, feature_usage âš ï¸ WRONG! â”‚
â”‚  âŒ Prisma:  NOT USED (should be!)                            *MUST FIXâ”‚
â”‚  ğŸ’¡ Subscription IS in Prisma schema but service ignores it!           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ CONNECTIONS SERVICE (connections.service.ts) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Prisma:  connection, chart                                          â”‚
â”‚  âŒ Supabase: Not used                                                  â”‚
â”‚  ğŸ’¡ PERFECT - Pure Prisma pattern                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ USER PHOTOS SERVICE (user-photos.service.ts) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Supabase: user_photos                                               â”‚
â”‚  âŒ Prisma:  Not used (table NOT in schema)                *SHOULD ADD   â”‚
â”‚  ğŸ’¡ 100% Supabase dependency - needs migration                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ USER REPOSITORY (user.repository.ts) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸ Fallback Pattern: Prisma â†’ Supabase Admin â†’ Test Users             â”‚
â”‚  ğŸ“ Direct Supabase calls: users, user_profiles (ADMIN)                â”‚
â”‚  ğŸ’¡ Mixed approach - unclear which is primary                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ CHART REPOSITORY (chart.repository.ts) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸ Fallback Pattern: Prisma â†’ Supabase Admin â†’ Supabase Regular       â”‚
â”‚  ğŸ“ Prisma: chart CRUD operations                                      â”‚
â”‚  ğŸ“ Supabase: Fallback via getUserChartsAdmin()                        â”‚
â”‚  ğŸ’¡ Good Prisma-first approach but has fallbacks                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
TABLES NOT IN PRISMA SCHEMA (CRITICAL GAPS)
================================================================================

Table                 Used In                  Operations    Priority
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
user_profiles         dating.service.ts        SELECT        CRITICAL
                      user.controller.ts       UPDATE

user_photos           user-photos.service.ts   CRUD          HIGH
                      dating.service.ts        SELECT
                      chat.service.ts

user_blocks           user.service.ts          INSERT/SELECT MEDIUM

user_reports          user.service.ts          INSERT        MEDIUM

messages              chat.service.ts          CRUD          MEDIUM

matches               chat.service.ts          CRUD          MEDIUM

payments              subscription.service.ts  INSERT/SELECT MEDIUM

feature_usage         analytics.service.ts     SELECT/INSERT MEDIUM

user_fomo_counters    (referenced)             Unknown       LOW

_test_connection      (test table)             Test ops      IGNORE

================================================================================
TABLES THAT ARE IN BOTH PRISMA AND SUPABASE (INCONSISTENT)
================================================================================

Table              Prisma âœ…  Supabase âœ…  Primary Access      Issue
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
charts             YES        YES         âš ï¸ MIXED             Used via both
                                         (Prisma in dating,    in same service
                                          Supabase in chart)

subscriptions      YES        YES         âš ï¸ WRONG             Subscription
                                         (Supabase only)       service ignores
                                                              Prisma model

users (public)     YES        YES         âš ï¸ MIXED             Used via both
                                         (Prisma in some,      in mixed pattern
                                          Supabase in other)

================================================================================
ACTION ITEMS (BY PRIORITY)
================================================================================

CRITICAL (Fix First):
  [1] subscription.service.ts - Replace .fromAdmin() with Prisma client
  [2] Add user_profiles to prisma/schema.prisma
  [3] Update chart.service.ts to use Prisma for AI generation timestamp

HIGH PRIORITY (Do Next):
  [4] Add user_photos to prisma/schema.prisma
  [5] Migrate user-photos.service.ts to use Prisma
  [6] Update dating.service.ts to use Prisma for user_profiles

MEDIUM PRIORITY (Later):
  [7] Add user_blocks model to Prisma
  [8] Add user_reports model to Prisma
  [9] Add messages & matches models to Prisma
  [10] Add payments & feature_usage models to Prisma

NICE TO HAVE:
  [11] Refactor repositories to remove Supabase fallbacks
  [12] Add user_fomo_counters if still needed

================================================================================
STATISTICS
================================================================================

Code Distribution:
  Services using Supabase for data:     8
  Services using Prisma primarily:      5
  Mixed pattern services:               6
  Prisma-only services:                 1  (connections)
  
Table Access Patterns:
  Prisma-only tables:                   3  (connections, dating_matches, ...)
  Supabase-only tables:                 10 (user_profiles, user_photos, ...)
  Both Prisma & Supabase:               3  (charts, subscriptions, users)

File Count:
  Total service files analyzed:         8
  Files needing migration:              5
  Correctly implemented:                3

Performance Impact:
  N+1 query risk areas:                 3  (photos batch create, user_profiles)
  Transaction support:                  1  (only user.service.ts)
  Type safety gaps:                     10 (all Supabase-only tables)

================================================================================
