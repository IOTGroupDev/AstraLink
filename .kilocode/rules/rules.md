---
title: 'AstraLink Internal Docs ‚Äî v1.0'
last_updated: '2025-10-04'
description: '–ï–¥–∏–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –∫–æ–¥-—Å—Ç–∏–ª—è –∏ –¥–∏–∑–∞–π–Ω–∞ AstraLink (Swiss Emphasis Edition)'
---

# AstraLink ‚Äì Code & Architecture Rules

## üß≠ –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

AstraLink ‚Äî —ç—Ç–æ –º–æ–¥—É–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å backend –Ω–∞ **NestJS**, ORM **Prisma**, –±–∞–∑–æ–π **PostgreSQL / Supabase**, –∏ frontend –Ω–∞ **React Native (Expo)**.  
–ü—Ä–æ–µ–∫—Ç —Å–æ—á–µ—Ç–∞–µ—Ç —Å—Ç—Ä–æ–≥—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–æ–π —Ñ–∏–ª–æ—Å–æ—Ñ–∏–µ–π **Swiss Emphasis**.

---

## üìÅ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### Backend (`/backend`)

#### –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏

| –ú–æ–¥—É–ª—å         | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                   | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏                                     |
| -------------- | ------------------------------------------------------------ | ---------------------------------------------------------- |
| `auth`         | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π                      | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç JWT, bcrypt, refresh-—Ç–æ–∫–µ–Ω—ã                     |
| `natal`        | –†–∞—Å—á—ë—Ç –Ω–∞—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç—ã –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ä–æ–∂–¥–µ–Ω–∏—è            | –ß–∏—Å—Ç—ã–µ —Å–µ—Ä–≤–∏—Å—ã, –≤–≤–æ–¥ —á–µ—Ä–µ–∑ DTO –¥–æ–±–∞–≤–∏—Ç—Å—è –ø–æ–∑–∂–µ             |
| `chart`        | –ì–æ—Ä–æ—Å–∫–æ–ø—ã, –ø–ª–∞–Ω–µ—Ç—ã, –∞—Å–ø–µ–∫—Ç—ã, —Ä–∞—Å—á–µ—Ç –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `natal` + `swiss`, API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç plain-–æ–±—ä–µ–∫—Ç—ã |
| `subscription` | –ü–æ–¥–ø–∏—Å–∫–∏, trial, premium-–¥–æ—Å—Ç—É–ø                              | –ß–∞—Å—Ç–∏—á–Ω–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–æ, DTO –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç                    |
| `swiss`        | –õ–æ–≥–∏–∫–∞ —ç—Ñ–µ–º–µ—Ä–∏–¥ —á–µ—Ä–µ–∑ Swiss Ephemeris                        | –°–µ—Ä–≤–∏—Å—ã + –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –±–µ–∑ DTO, —Ñ—É–Ω–∫—Ü–∏–∏ pure               |
| `shared`       | –û–±—â–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã, –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã, —Ç–∏–ø—ã –∏ —É—Ç–∏–ª–∏—Ç—ã                  | –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∏–∑ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª–µ–π                             |

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

```
/src/modules/<module>/
  ‚îú‚îÄ <module>.controller.ts
  ‚îú‚îÄ <module>.service.ts
  ‚îú‚îÄ dto/               # –µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ
  ‚îú‚îÄ entities/          # prisma –º–æ–¥–µ–ª–∏, –Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –Ω–∞—Ä—É–∂—É
  ‚îú‚îÄ <module>.module.ts
```

#### –ò–º–ø–æ—Ä—Ç—ã –∏ –≥—Ä–∞–Ω–∏—Ü—ã

- –ê–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏ —á–µ—Ä–µ–∑ `@/`.
- –ú–µ–∂–º–æ–¥—É–ª—å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã.
- –û–±—â–∏–µ —Ç–∏–ø—ã ‚Äî —á–µ—Ä–µ–∑ `/shared`.

#### DTO –∏ —Ç–∏–ø–∏–∑–∞—Ü–∏—è

- DTO –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã **–¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö API** (`auth`, `subscription`).
- –í –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –º–æ–¥—É–ª—è—Ö (`natal`, `chart`, `swiss`) –ø–æ–∫–∞ –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è plain-–æ–±—ä–µ–∫—Ç—ã.
- DTO —Ö—Ä–∞–Ω—è—Ç—Å—è —Ä—è–¥–æ–º —Å –º–æ–¥—É–ª–µ–º –≤ `/dto`.

#### –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏ —Å–µ—Ä–≤–∏—Å—ã

- –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã —Ç–æ–Ω–∫–∏–µ, —Å–µ—Ä–≤–∏—Å—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É.
- –ü—É–±–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã: `get`, `create`, `update`, `delete`.
- –ß–∞—Å—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã ‚Äî —Å `private` –∏–ª–∏ `_–∏–º—è`.

#### Prisma ORM

- –ú–æ–¥–µ–ª–∏ ‚Üí `/prisma/schema.prisma`
- –ú–∏–≥—Ä–∞—Ü–∏–∏ ‚Üí `/prisma/migrations`
- Singleton-–∏–Ω—Å—Ç–∞–Ω—Å `PrismaService`
- –¢–æ–ª—å–∫–æ Prisma API, –±–µ–∑ SQL-—Å—Ç—Ä–æ–∫

---

### Frontend (`/app`)

React Native (Expo) + TypeScript.

| –ü–∞–ø–∫–∞         | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                     |
| ------------- | -------------------------------------------------------------- |
| `/screens`    | –û—Å–Ω–æ–≤–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã (`Home`, `Profile`, `Chart`, `Subscription`)   |
| `/components` | –ü–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ UI-—ç–ª–µ–º–µ–Ω—Ç—ã                              |
| `/hooks`      | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ö—É–∫–∏ (–ª–æ–≥–∏–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏, auth, –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö) |
| `/context`    | AuthContext, SubscriptionContext, ThemeContext                 |
| `/api`        | –û–±—ë—Ä—Ç–∫–∏ –Ω–∞–¥ backend-—ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏                                |
| `/swiss`      | –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç—Ñ–µ–º–µ—Ä–∏–¥ –∏ –∞—Å–ø–µ–∫—Ç–æ–≤                                |
| `/assets`     | –®—Ä–∏—Ñ—Ç—ã, –∏–∫–æ–Ω–∫–∏, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è                                    |

#### API

- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞: `/app/api/index.ts`
- –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ (`handleApiError`)
- –¢–æ–∫–µ–Ω—ã ‚Äî —á–µ—Ä–µ–∑ `SecureStore`

---

## üé® –î–∏–∑–∞–π–Ω –∏ —Å—Ç–∏–ª—å (Swiss Emphasis)

- –°–ª–µ–¥–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –¥–∏–∑–∞–π–Ω—É AstraLink.
- **Swiss Emphasis** = –º–∏–Ω–∏–º–∞–ª–∏–∑–º, –±–∞–ª–∞–Ω—Å, —á—ë—Ç–∫–æ—Å—Ç—å, —Å–º—ã—Å–ª.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—É—é —Ç–µ–º—É (`/app/theme/tokens.ts`).
- –ù–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ–±—è–∑–∞–Ω—ã –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–µ —Ç–æ–∫–µ–Ω—ã (—Ü–≤–µ—Ç–∞, spacing, radius).

#### –ü—Ä–æ–ø–æ—Ä—Ü–∏–∏ –∏ —Ä–∏—Ç–º

- –°–µ—Ç–∫–∞: —à–∞–≥ 8 px
- –†–∞–¥–∏—É—Å: 8‚Äì16 px
- –û—Ç—Å—Ç—É–ø—ã –∫—Ä–∞—Ç–Ω—ã 4 px
- –¢–æ–ª—å–∫–æ —Ü–≤–µ—Ç–∞ –∏ —Ä–∞–∑–º–µ—Ä—ã –∏–∑ `tokens.ts`

#### –ê–Ω–∏–º–∞—Ü–∏–∏

- `react-native-reanimated` –∏–ª–∏ `moti`
- –ü–ª–∞–≤–Ω—ã–µ, –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã
- –ë–µ–∑ ‚Äú–≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —à—É–º–∞‚Äù

---

## ‚öôÔ∏è –ü—Ä–∞–≤–∏–ª–∞ –∫–æ–¥–∞

### TypeScript

- `strict` –∞–∫—Ç–∏–≤–µ–Ω
- `any` –∑–∞–ø—Ä–µ—â—ë–Ω (–∫—Ä–æ–º–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç)
- –í—Å–µ –ø—É–±–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- –î–æ–ø—É—Å–∫–∞—é—Ç—Å—è plain-–æ–±—ä–µ–∫—Ç—ã –≤ `natal`, `chart`, `swiss` (–¥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è DTO)

### React

- –¢–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- Props —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏
- –ë–µ–∑ inline-—Ñ—É–Ω–∫—Ü–∏–π –≤ JSX
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ, derive –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ

### NestJS

- –ú–æ–¥—É–ª–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã
- –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã: `@Controller`, `@Get`, `@Post`, ‚Ä¶
- –û—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ `HttpException`
- DTO-–≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ `class-validator`

### Supabase

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ backend-–æ–±—ë—Ä—Ç–∫—É (`supabase.service.ts`)
- `SUPABASE_SERVICE_ROLE_KEY` ‚Äî —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- Frontend –≤—ã–∑—ã–≤–∞–µ—Ç backend, –Ω–µ –Ω–∞–ø—Ä—è–º—É—é Supabase

---

## üß© Swiss Module

- –û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ä–∞—Å—á—ë—Ç —ç—Ñ–µ–º–µ—Ä–∏–¥
- Pure-—Ñ—É–Ω–∫—Ü–∏–∏, –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç –ë–î
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `swisseph` (–∏–ª–∏ WASM)
- –ö–µ—à–∏—Ä—É–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
- –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è DTO (`SwissResultDto`)

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- JWT (access + refresh)
- –ü–∞—Ä–æ–ª–∏: `bcrypt`
- –í—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è
- `.env` ‚Äî –≤–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- CORS —Ç–æ–ª—å–∫–æ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ AstraLink
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Sentry (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üöÄ Dev & Deploy

```bash
# Backend
cd backend
npm run start:dev

# Frontend
cd app
npx expo start
```

### –°—Ä–µ–¥—ã

- `.env` ‚Äî –ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- `.env.staging` ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- `.env.production` ‚Äî –ø—Ä–æ–¥–∞–∫—à–Ω

---

## üß† –ü—Ä–∏–Ω—Ü–∏–ø—ã AstraLink

1. **Consistency over cleverness** ‚Äî –ª—É—á—à–µ –ø–æ–Ω—è—Ç–Ω–æ, —á–µ–º "–≥–µ–Ω–∏–∞–ª—å–Ω–æ".
2. **Predictable flow** ‚Äî –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö.
3. **Clear boundaries** ‚Äî –æ–¥–∏–Ω –º–æ–¥—É–ª—å = –æ–¥–Ω–∞ –∑–æ–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.
4. **Swiss balance** ‚Äî —á–∏—Å—Ç–æ—Ç–∞ —Ñ–æ—Ä–º—ã –∏ —Ç–æ—á–Ω–æ—Å—Ç—å –∫–æ–¥–∞.
5. **Iterate with discipline** ‚Äî —É–ª—É—á—à–∞–π –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ.

---

## üßæ –ò—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã

| –û–±–ª–∞—Å—Ç—å         | –§–∞–π–ª / –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è               |
| --------------- | ------------------------------- |
| Backend API     | `/backend/src`                  |
| Prisma Schema   | `/backend/prisma/schema.prisma` |
| Frontend Theme  | `/app/theme/tokens.ts`          |
| –û–±—â–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã | `/shared/constants.ts`          |

---

## ü™∂ Changelog

| –í–µ—Ä—Å–∏—è | –î–∞—Ç–∞       | –ò–∑–º–µ–Ω–µ–Ω–∏—è                                                                                     |
| ------ | ---------- | --------------------------------------------------------------------------------------------- |
| 1.0    | 2025-10-04 | –ù–∞—á–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–∞–≤–∏–ª, –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ–¥ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É AstraLink –∏ Swiss Emphasis |

---

¬© AstraLink Project, 2025  
–ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ Kilo Code ‚Äî Swiss Emphasis Edition.
