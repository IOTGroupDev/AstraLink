# üéØ –¢–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã –∏ –¥–æ—Å—Ç—É–ø –∫ AI —Ñ—É–Ω–∫—Ü–∏—è–º

**–î–∞—Ç–∞:** 13 —è–Ω–≤–∞—Ä—è 2025
**–í–µ—Ä—Å–∏—è:** 1.0

---

## üìã –û–±–∑–æ—Ä —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤

AstraLink –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ç—Ä–∏ —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –ø–ª–∞–Ω–∞ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º —É—Ä–æ–≤–Ω–µ–º –¥–æ—Å—Ç—É–ø–∞ –∫ AI —Ñ—É–Ω–∫—Ü–∏—è–º:

| –¢–∞—Ä–∏—Ñ | –¶–µ–Ω–∞ | AI –î–æ—Å—Ç—É–ø | –ì–æ—Ä–æ—Å–∫–æ–ø—ã | –°–æ–≤–µ—Ç–Ω–∏–∫ | –ù–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ |
|-------|------|-----------|-----------|----------|-----------------|
| **FREE** | $0 | ‚ùå –ù–µ—Ç | –ü—Ä–∞–≤–∏–ª–∞ | ‚ùå –ù–µ—Ç | 20% –¥–∞–Ω–Ω—ã—Ö |
| **PREMIUM** | $14.99/–º–µ—Å | ‚úÖ –ü–æ–ª–Ω—ã–π | AI (1/–¥–µ–Ω—å) | 30/–¥–µ–Ω—å | 100% —Å AI |
| **MAX** | $19.99/–º–µ—Å | ‚úÖ –ü–æ–ª–Ω—ã–π | AI (1/–¥–µ–Ω—å) | 100/–¥–µ–Ω—å | 100% —Å AI + VIP |

---

## üÜì FREE (–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π)

### –î–æ—Å—Ç—É–ø –∫ AI
- ‚ùå **–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ AI** —Ñ—É–Ω–∫—Ü–∏—è–º
- –ù–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è Swiss Ephemeris
- –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∞–≤–∏–ª (–±–µ–∑ AI)

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- –ë–∞–∑–æ–≤–∞—è –Ω–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ (20% –¥–∞–Ω–Ω—ã—Ö)
- –ì–æ—Ä–æ—Å–∫–æ–ø—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–∏–ª (–±–µ–∑ AI)
- –¢—Ä–∞–Ω–∑–∏—Ç—ã –±–µ–∑ –¥–µ—Ç–∞–ª–µ–π
- 1 –∞–Ω–∞–ª–∏–∑ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (—Ç–æ–ª—å–∫–æ %)
- –õ—É–Ω–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å (—Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å)

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
```typescript
{
  aiAccess: false,              // ‚ùå –ù–µ—Ç AI
  advisorQueries: 0,            // ‚ùå –ù–µ—Ç —Å–æ–≤–µ—Ç–Ω–∏–∫–∞
  horoscope: 'interpreter',     // –¢–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª–∞
  natalChart: 0.2               // 20% –¥–∞–Ω–Ω—ã—Ö
}
```

---

## üíé PREMIUM (–ü—Ä–µ–º–∏—É–º) - $14.99/–º–µ—Å

### –î–æ—Å—Ç—É–ø –∫ AI
- ‚úÖ **–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ AI** —Ñ—É–Ω–∫—Ü–∏—è–º
- Swiss Ephemeris –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–∞—Ç–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É
- AI —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ
- AI —Å–æ–≤–µ—Ç–Ω–∏–∫ –¥–æ—Å—Ç—É–ø–µ–Ω

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- **–ü–æ–ª–Ω–∞—è –Ω–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å AI –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–µ–π**
- **AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ—Å–∫–æ–ø–æ–≤** (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ 1 —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏)
- **AI –°–æ–≤–µ—Ç–Ω–∏–∫: 30 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å—É—Ç–∫–∏** üéØ
- –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∏—Ç—ã –∏ –ø—Ä–æ–≥–Ω–æ–∑—ã
- –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- –ê—Å—Ç—Ä–æ—Å–∏–º—É–ª—è—Ç–æ—Ä (–º–∞—à–∏–Ω–∞ –≤—Ä–µ–º–µ–Ω–∏)
- Cosmic Dating (–Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ)
- –õ—É–Ω–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å (–ø–æ–ª–Ω—ã–π –º–µ—Å—è—Ü)
- –ë–∏–æ—Ä–∏—Ç–º—ã –∏ –ø—Ä–∞–∫—Ç–∏–∫–∏

### AI –õ–∏–º–∏—Ç—ã
```typescript
{
  aiAccess: true,                  // ‚úÖ –ü–æ–ª–Ω—ã–π AI –¥–æ—Å—Ç—É–ø
  advisorQueries: 30,              // üéØ 30 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–æ–≤–µ—Ç–Ω–∏–∫—É –≤ —Å—É—Ç–∫–∏
  horoscopeRefresh: 'daily',       // üéØ –ì–æ—Ä–æ—Å–∫–æ–ø –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è 1 —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏
  horoscope: 'ai',                 // AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
  natalChart: 1                    // 100% –¥–∞–Ω–Ω—ã—Ö —Å AI
}
```

### Workflow
1. **–ù–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞:**
   ```
   User Request ‚Üí Swiss Ephemeris ‚Üí –ê—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ ‚Üí AI –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è ‚Üí User
   ```

2. **–ì–æ—Ä–æ—Å–∫–æ–ø:**
   ```
   User Request ‚Üí Check last update ‚Üí If >24h ‚Üí AI Generation ‚Üí Cache ‚Üí User
   ```

3. **–°–æ–≤–µ—Ç–Ω–∏–∫:**
   ```
   User Request ‚Üí Check rate limit (30/day) ‚Üí AI Analysis ‚Üí User
   ```

---

## üëë MAX (–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π) - $19.99/–º–µ—Å

### –î–æ—Å—Ç—É–ø –∫ AI
- ‚úÖ **–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ AI** —Ñ—É–Ω–∫—Ü–∏—è–º (–∫–∞–∫ Premium)
- –í—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Premium
- –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ –ª–∏–º–∏—Ç—ã —Å–æ–≤–µ—Ç–Ω–∏–∫–∞

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ Premium
- **AI –°–æ–≤–µ—Ç–Ω–∏–∫: 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å—É—Ç–∫–∏** üéØ (–≤–º–µ—Å—Ç–æ 30)
- 2 –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –∞—Å—Ç—Ä–æ–ª–æ–≥–∞/–≥–æ–¥
- –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –ø—Ä–æ–≥–Ω–æ–∑—ã –∏ —Ä–∏—Ç—É–∞–ª—ã
- –†–∞–Ω–Ω–∏–π –¥–æ—Å—Ç—É–ø –∫ –Ω–æ–≤—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º
- VIP –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –≥–æ–¥–æ–≤–æ–π –≥–æ—Ä–æ—Å–∫–æ–ø (PDF)
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤ Dating

### AI –õ–∏–º–∏—Ç—ã
```typescript
{
  aiAccess: true,                  // ‚úÖ –ü–æ–ª–Ω—ã–π AI –¥–æ—Å—Ç—É–ø
  advisorQueries: 100,             // üéØ 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–æ–≤–µ—Ç–Ω–∏–∫—É –≤ —Å—É—Ç–∫–∏ (vs 30)
  horoscopeRefresh: 'daily',       // üéØ –ì–æ—Ä–æ—Å–∫–æ–ø –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è 1 —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏
  horoscope: 'ai',                 // AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
  natalChart: 1,                   // 100% –¥–∞–Ω–Ω—ã—Ö —Å AI
  priority: true                   // VIP –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
}
```

---

## üîê –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫ –¥–æ—Å—Ç—É–ø–∞

### 1. Subscription Guard

–í—Å–µ AI endpoints –∑–∞—â–∏—â–µ–Ω—ã `SubscriptionGuard` –∏ `RequiresSubscription` –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º:

```typescript
@ApiTags('AI')
@Controller('ai')
@UseGuards(SupabaseAuthGuard, SubscriptionGuard)
export class AIController {

  @Post('horoscope/generate')
  @RequiresSubscription(SubscriptionTier.PREMIUM, SubscriptionTier.MAX)
  async generateHoroscope() {
    // –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è PREMIUM –∏ MAX
  }
}
```

### 2. Advisor Rate Limiting

–°–æ–≤–µ—Ç–Ω–∏–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `AdvisorRateLimitGuard` –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤:

```typescript
@Post('evaluate')
@UseGuards(AdvisorRateLimitGuard) // 30/–¥–µ–Ω—å (Premium), 100/–¥–µ–Ω—å (MAX)
@RequiresSubscription(SubscriptionTier.PREMIUM, SubscriptionTier.MAX)
async evaluate() {
  // Rate limiting –≤ Redis
}
```

**–ú–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–±–æ—Ç—ã:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –∏–∑ FEATURE_MATRIX
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—á–µ—Ç—á–∏–∫–∞ –≤ Redis (–∫–ª—é—á: `advisor:rate_limit:{userId}:{date}`)
4. –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç —Å—á–µ—Ç—á–∏–∫–∞
5. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ TTL –¥–æ –∫–æ–Ω—Ü–∞ –¥–Ω—è

### 3. Horoscope Daily Limit

–ì–æ—Ä–æ—Å–∫–æ–ø—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –Ω–µ —á–∞—â–µ 1 —Ä–∞–∑–∞ –≤ —Å—É—Ç–∫–∏:

```typescript
// –í HoroscopeGeneratorService
const cacheKey = `horoscope:${userId}:${period}:${today}`;
const cached = await redis.get(cacheKey);

if (cached) {
  return cached; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø
}

// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–µ—à–∞ –Ω–µ—Ç
const horoscope = await aiService.generateHoroscope(context);
await redis.setex(cacheKey, 86400, horoscope); // 24 —á–∞—Å–∞
```

---

## üìä API Endpoints –∏ –¥–æ—Å—Ç—É–ø

### AI Controller (`/api/ai/...`)

| Endpoint | FREE | PREMIUM | MAX | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|------|---------|-----|----------|
| `GET /status` | ‚úÖ | ‚úÖ | ‚úÖ | –°—Ç–∞—Ç—É—Å AI —Å–µ—Ä–≤–∏—Å–æ–≤ |
| `POST /horoscope/generate` | ‚ùå | ‚úÖ | ‚úÖ | AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–æ—Ä–æ—Å–∫–æ–ø–∞ |
| `POST /horoscope/direct` | ‚ùå | ‚úÖ | ‚úÖ | –ü—Ä—è–º–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –≤—ã–±–æ—Ä–æ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ |
| `POST /horoscope/stream` | ‚ùå | ‚úÖ | ‚úÖ | Streaming –≥–µ–Ω–µ—Ä–∞—Ü–∏—è |
| `GET /usage/stats` | ‚ùå | ‚úÖ | ‚úÖ | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |

### Advisor Controller (`/api/advisor/...`)

| Endpoint | FREE | PREMIUM | MAX | –õ–∏–º–∏—Ç |
|----------|------|---------|-----|-------|
| `POST /evaluate` | ‚ùå | ‚úÖ (30/–¥–µ–Ω—å) | ‚úÖ (100/–¥–µ–Ω—å) | AI —Å–æ–≤–µ—Ç–Ω–∏–∫ |
| `GET /usage` | ‚ùå | ‚úÖ | ‚úÖ | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |

### Chart Controller (`/api/chart/...`)

| Endpoint | FREE | PREMIUM | MAX | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|------|---------|-----|----------|
| `GET /natal` | ‚úÖ (20%) | ‚úÖ (100%) | ‚úÖ (100%) | –ù–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ |
| `GET /interpretation` | ‚ùå | ‚úÖ AI | ‚úÖ AI | AI –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è |

---

## üß™ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ AI (FREE –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

**Request:**
```bash
curl -X POST http://localhost:3000/api/ai/horoscope/generate \
  -H "Authorization: Bearer FREE_USER_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"period": "day"}'
```

**Response:**
```json
{
  "statusCode": 403,
  "message": "–¢—Ä–µ–±—É–µ—Ç—Å—è PREMIUM –∏–ª–∏ MAX –ø–æ–¥–ø–∏—Å–∫–∞",
  "requiredTiers": ["premium", "max"]
}
```

### 2. AI –°–æ–≤–µ—Ç–Ω–∏–∫ (PREMIUM –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

**Request 1-30:**
```bash
curl -X POST http://localhost:3000/api/advisor/evaluate \
  -H "Authorization: Bearer PREMIUM_USER_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"topic": "career", "date": "2025-01-13"}'
```

**Response (—É—Å–ø–µ—Ö):**
```json
{
  "advice": "–°–µ–≥–æ–¥–Ω—è –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã–π –¥–µ–Ω—å –¥–ª—è –∫–∞—Ä—å–µ—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π",
  "score": 8.5,
  "rateLimit": {
    "current": 15,
    "limit": 30,
    "remaining": 15,
    "tier": "premium"
  }
}
```

**Request 31+ (–ª–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω):**
```json
{
  "statusCode": 403,
  "message": "–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–æ–≤–µ—Ç–Ω–∏–∫—É (30 –≤ —Å—É—Ç–∫–∏ –¥–ª—è Premium). –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≤—Ç—Ä–∞."
}
```

### 3. AI –°–æ–≤–µ—Ç–Ω–∏–∫ (MAX –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

–õ–∏–º–∏—Ç: 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å (–≤–º–µ—Å—Ç–æ 30)

---

## üí∞ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤—ã–±–æ—Ä—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

### –ü–æ —Ç–∞—Ä–∏—Ñ–∞–º:

**FREE:**
- –ü—Ä–æ–≤–∞–π–¥–µ—Ä: –ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ (–Ω–µ—Ç AI)
- Swiss Ephemeris –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏

**PREMIUM:**
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä: **DeepSeek** (–ª—É—á—à–µ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ü–µ–Ω–∞/–∫–∞—á–µ—Å—Ç–≤–æ)
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: OpenAI gpt-4o-mini
- –°—Ç–æ–∏–º–æ—Å—Ç—å: ~$1.50 –∑–∞ 1000 –≥–æ—Ä–æ—Å–∫–æ–ø–æ–≤

**MAX:**
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä: **Claude Sonnet 4.5** (–ø—Ä–µ–º–∏—É–º –∫–∞—á–µ—Å—Ç–≤–æ)
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: DeepSeek (—ç–∫–æ–Ω–æ–º–∏—è)
- –°—Ç–æ–∏–º–æ—Å—Ç—å: $15-25 –∑–∞ 1000 –≥–æ—Ä–æ—Å–∫–æ–ø–æ–≤ (Claude) –∏–ª–∏ $1.50 (DeepSeek)

### –ì–ª–æ–±–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:

```bash
# .env
# –î–ª—è PREMIUM –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—ç–∫–æ–Ω–æ–º–∏—è)
AI_PROVIDER_PREFERENCE="deepseek"

# –î–ª—è MAX –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–ø—Ä–µ–º–∏—É–º)
AI_PROVIDER_PREFERENCE="claude"

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä (Claude > DeepSeek > OpenAI)
AI_PROVIDER_PREFERENCE="auto"
```

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### Redis –∫–ª—é—á–∏ –¥–ª—è –ª–∏–º–∏—Ç–æ–≤:

```
# –°–æ–≤–µ—Ç–Ω–∏–∫
advisor:rate_limit:{userId}:{YYYY-MM-DD}

# –ì–æ—Ä–æ—Å–∫–æ–ø (–∫–µ—à)
horoscope:{userId}:{period}:{YYYY-MM-DD}

# –ù–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ (–∫–µ—à)
natal_chart:{userId}:{birthDate}
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```typescript
// –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–æ–≤–µ—Ç–Ω–∏–∫–∞
GET /api/advisor/usage

// Response:
{
  "date": "2025-01-13",
  "used": 15,
  "limit": 30,  // –∏–ª–∏ 100 –¥–ª—è MAX
  "remaining": 15,
  "tier": "premium"
}
```

---

## üöÄ –ú–∏–≥—Ä–∞—Ü–∏—è –º–µ–∂–¥—É —Ç–∞—Ä–∏—Ñ–∞–º–∏

### FREE ‚Üí PREMIUM/MAX

–ü—Ä–∏ –∞–ø–≥—Ä–µ–π–¥–µ:
1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ AI —Ñ—É–Ω–∫—Ü–∏—è–º
2. –õ–∏–º–∏—Ç—ã —Å–æ–≤–µ—Ç–Ω–∏–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç—Å—è —Å—Ä–∞–∑—É
3. –ö–µ—à –≥–æ—Ä–æ—Å–∫–æ–ø–æ–≤ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ AI –≤–µ—Ä—Å–∏–∏

### PREMIUM ‚Üí MAX

–ü—Ä–∏ –∞–ø–≥—Ä–µ–π–¥–µ:
1. –õ–∏–º–∏—Ç —Å–æ–≤–µ—Ç–Ω–∏–∫–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Å 30 –¥–æ 100
2. –°—á–µ—Ç—á–∏–∫ –≤ Redis –æ—Å—Ç–∞–µ—Ç—Å—è (—É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è)
3. –î–æ—Å—Ç—É–ø –∫ VIP —Ñ—É–Ω–∫—Ü–∏—è–º –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è

### PREMIUM/MAX ‚Üí FREE

–ü—Ä–∏ –¥–∞—É–Ω–≥—Ä–µ–π–¥–µ:
1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ AI —Ñ—É–Ω–∫—Ü–∏–π
2. –õ–∏–º–∏—Ç—ã —Å–æ–≤–µ—Ç–Ω–∏–∫–∞ = 0
3. –ö–µ—à –≥–æ—Ä–æ—Å–∫–æ–ø–æ–≤ –æ—Å—Ç–∞–µ—Ç—Å—è, –Ω–æ –Ω–æ–≤—ã–µ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

- [x] ‚úÖ FEATURE_MATRIX –æ–±–Ω–æ–≤–ª–µ–Ω —Å –ª–∏–º–∏—Ç–∞–º–∏ AI –∏ —Å–æ–≤–µ—Ç–Ω–∏–∫–∞
- [x] ‚úÖ AdvisorRateLimitGuard —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] ‚úÖ –í—Å–µ AI endpoints –∑–∞—â–∏—â–µ–Ω—ã @RequiresSubscription
- [x] ‚úÖ Rate limiting –¥–ª—è —Å–æ–≤–µ—Ç–Ω–∏–∫–∞ (30 Premium, 100 MAX)
- [x] ‚úÖ –ì–æ—Ä–æ—Å–∫–æ–ø—ã –∫–µ—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ 24 —á–∞—Å–∞
- [x] ‚úÖ FREE –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ AI
- [x] ‚úÖ –¢—Ä–µ–∫ –ª–∏–º–∏—Ç–æ–≤ –≤ Redis —Å TTL –¥–æ –∫–æ–Ω—Ü–∞ –¥–Ω—è

---

## üìû Support

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º –∏ AI –¥–æ—Å—Ç—É–ø—É:
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `/docs/subscription`
- API Swagger: `/api/docs`
- Status endpoint: `GET /api/ai/status`

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 13 —è–Ω–≤–∞—Ä—è 2025
**–í–µ—Ä—Å–∏—è:** 1.0 - –¢–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã –∏ AI –¥–æ—Å—Ç—É–ø
